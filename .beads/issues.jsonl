{"id":"m5-paper-s3-mtg-life-counter-0g5","title":"Button component with touch debounce","description":"**Plan**: /Users/stuart/.claude/plans/parallel-fluttering-stream.md (Epic 2)\n\n**Goal**: Create reusable Button component with proper touch handling.\n\n**What to implement**:\n\n**Button** (`src/ui/Button.hpp/cpp`):\n- Extends Component\n- `Button(Rect bounds, const char* label, std::function\u003cvoid()\u003e onClick)`\n- 150ms debounce between activations\n- Visual states: normal, pressed\n- `draw()` - renders button with label, inverted when pressed\n- `handleTouch()` - uses wasClicked() not isPressed(), fires callback\n\n**Design**:\n- Large touch targets (min 80x80 per plan)\n- High contrast for e-ink: black border, white fill, black text\n- Pressed state: inverted colors\n\n**Files to create**:\n- `src/ui/Button.hpp` (~30 lines)\n- `src/ui/Button.cpp` (~60 lines)\n\n**Dependencies**: Requires Component base class\n\n**Acceptance criteria**:\n- [ ] Button renders with label\n- [ ] Touch inside bounds triggers callback\n- [ ] Touch outside bounds ignored\n- [ ] Rapid taps debounced (only one callback per 150ms)\n- [ ] Visual feedback on press","status":"closed","priority":1,"issue_type":"task","owner":"stuart.bradley@wagestream.co.uk","created_at":"2026-01-14T19:18:31.603147Z","created_by":"Stuart Bradley","updated_at":"2026-01-14T19:37:59.807389Z","closed_at":"2026-01-14T19:37:59.807389Z","close_reason":"Button component implemented: extends Component, 150ms debounce, visual pressed state (inverted colors), centered label. Compilation successful.","dependencies":[{"issue_id":"m5-paper-s3-mtg-life-counter-0g5","depends_on_id":"m5-paper-s3-mtg-life-counter-sho","type":"blocks","created_at":"2026-01-14T19:20:39.661533Z","created_by":"Stuart Bradley"}]}
{"id":"m5-paper-s3-mtg-life-counter-1x5","title":"MTG Life Screen: dynamic grid layout for 2-6 players","description":"**Plan**: /Users/stuart/.claude/plans/parallel-fluttering-stream.md (Epic 4)\n\n**Goal**: Create main MTG life counter screen with dynamic player layouts.\n\n**What to implement**:\n\n**MTGLifeScreen** (`src/ui/screens/MTGLifeScreen.hpp/cpp`):\n- Extends Screen\n- Holds GameState reference, array of PlayerCard components\n- Toolbar at top, gear icon to open MTGSettingsScreen\n- Dynamic grid based on player count\n\n**Layouts** (960x500 usable area below toolbar):\n- 2 players: 2 cards side by side (480x400 each)\n- 3 players: 3 cards in row (320x400 each)\n- 4 players: 2x2 grid (480x200 each)\n- 5 players: 3 top, 2 bottom (320x200 each)\n- 6 players: 3x2 grid (320x200 each)\n\n**Behavior**:\n- `onEnter()` - load GameState from NVS, create PlayerCards\n- When player count changes (from settings), recreate layout\n- Gear icon tap -\u003e ScreenManager::setScreen(MTGSettingsScreen)\n- Player name tap -\u003e show Keyboard overlay, update name on confirm\n- Auto-save to NVS periodically (every 5 seconds if dirty) or on exit\n\n**Keyboard integration**:\n- When name tapped, show Keyboard component as overlay\n- On confirm, update player name, hide keyboard, save state\n\n**Files to create**:\n- `src/ui/screens/MTGLifeScreen.hpp` (~40 lines)\n- `src/ui/screens/MTGLifeScreen.cpp` (~200 lines)\n\n**Dependencies**:\n- Screen, ScreenManager\n- PlayerCard component\n- Keyboard component\n- GameState model\n- Toolbar component\n\n**Acceptance criteria**:\n- [ ] Displays correct number of PlayerCards based on playerCount\n- [ ] All life buttons work for all players\n- [ ] Tapping name opens keyboard, editing works\n- [ ] Gear icon navigates to settings\n- [ ] Game state auto-saves\n- [ ] Layout adapts correctly for 2/3/4/5/6 players","status":"closed","priority":1,"issue_type":"feature","owner":"stuart.bradley@wagestream.co.uk","created_at":"2026-01-14T19:19:40.549334Z","created_by":"Stuart Bradley","updated_at":"2026-01-14T20:12:51.02971Z","closed_at":"2026-01-14T20:12:51.02971Z","close_reason":"Core functionality complete: life buttons, name editing, keyboard, auto-save all working","dependencies":[{"issue_id":"m5-paper-s3-mtg-life-counter-1x5","depends_on_id":"m5-paper-s3-mtg-life-counter-70s","type":"blocks","created_at":"2026-01-14T19:20:53.466561Z","created_by":"Stuart Bradley"},{"issue_id":"m5-paper-s3-mtg-life-counter-1x5","depends_on_id":"m5-paper-s3-mtg-life-counter-qj1","type":"blocks","created_at":"2026-01-14T19:20:53.596588Z","created_by":"Stuart Bradley"},{"issue_id":"m5-paper-s3-mtg-life-counter-1x5","depends_on_id":"m5-paper-s3-mtg-life-counter-tdp","type":"blocks","created_at":"2026-01-14T19:20:53.710636Z","created_by":"Stuart Bradley"}]}
{"id":"m5-paper-s3-mtg-life-counter-39s","title":"MTG Settings Screen: player count, starting life, reset game","description":"**Plan**: /Users/stuart/.claude/plans/parallel-fluttering-stream.md (Epic 4)\n\n**Goal**: Create settings screen for MTG game configuration.\n\n**What to implement**:\n\n**MTGSettingsScreen** (`src/ui/screens/MTGSettingsScreen.hpp/cpp`):\n- Extends Screen\n- Back button to return to MTGLifeScreen\n\n**Settings rows**:\n1. **Player Count**: [2] [3] [4] [5] [6] - radio buttons\n2. **Starting Life**: [20] [25] [30] [40] - radio buttons\n3. **Reset Game**: [Reset Life] - resets all players to starting life\n4. **New Game**: [New Game] - reset life + reset names to defaults\n\n**Layout** (960x540):\n```\n[Toolbar]\n[\u003c Back]\n\nPlayers:    [2] [3] [4] [5] [6]\n\nStarting:   [20] [25] [30] [40]\n\n[  Reset Life  ]   [  New Game  ]\n\n```\n\n**Behavior**:\n- Player count change: update GameState, add/remove players\n- Starting life change: only affects new games, not current life\n- Reset Life: confirm dialog -\u003e reset all to starting life\n- New Game: confirm dialog -\u003e reset life + names (\"Player 1\", etc.)\n- Back: save settings, return to life screen\n\n**Confirm dialog**: Simple modal with [Cancel] [Confirm]\n\n**Files to create**:\n- `src/ui/screens/MTGSettingsScreen.hpp` (~35 lines)\n- `src/ui/screens/MTGSettingsScreen.cpp` (~180 lines)\n\n**Dependencies**:\n- Screen, ScreenManager\n- Button component\n- GameState model\n- Toolbar component\n\n**Acceptance criteria**:\n- [ ] Player count selector works (2-6)\n- [ ] Starting life selector works (20/25/30/40)\n- [ ] Reset Life resets all players to starting life\n- [ ] New Game resets life + names\n- [ ] Both reset actions show confirm dialog\n- [ ] Back returns to life screen\n- [ ] Changes persist after back navigation","status":"closed","priority":1,"issue_type":"feature","owner":"stuart.bradley@wagestream.co.uk","created_at":"2026-01-14T19:19:51.676171Z","created_by":"Stuart Bradley","updated_at":"2026-01-14T20:42:52.908329Z","closed_at":"2026-01-14T20:42:52.908329Z","close_reason":"Implemented MTG Settings Screen with player count, starting life, reset options, and confirm dialogs","dependencies":[{"issue_id":"m5-paper-s3-mtg-life-counter-39s","depends_on_id":"m5-paper-s3-mtg-life-counter-1x5","type":"blocks","created_at":"2026-01-14T19:20:57.559113Z","created_by":"Stuart Bradley"},{"issue_id":"m5-paper-s3-mtg-life-counter-39s","depends_on_id":"m5-paper-s3-mtg-life-counter-0g5","type":"blocks","created_at":"2026-01-14T19:20:57.689521Z","created_by":"Stuart Bradley"}]}
{"id":"m5-paper-s3-mtg-life-counter-4pz","title":"Data models: Player, GameState, Settings with NVS persistence","description":"**Plan**: /Users/stuart/.claude/plans/parallel-fluttering-stream.md (Epic 1)\n\n**Goal**: Create core data models with NVS load/save.\n\n**What to implement**:\n\n1. **Player struct** (`src/models/Player.hpp`):\n   - `char name[16]` - fixed size for NVS simplicity\n   - `int16_t life`\n   - `reset(int16_t startingLife)`, `adjustLife(int16_t delta)` - clamps -999 to 9999\n\n2. **GameState struct** (`src/models/GameState.hpp/cpp`):\n   - `uint8_t playerCount` (2-6), `int16_t startingLife` (20/25/30/40)\n   - `Player players[6]`\n   - `reset()`, `initDefaults()`, `load(Preferences\u0026)`, `save(Preferences\u0026)`\n\n3. **Settings struct** (`src/models/Settings.hpp/cpp`):\n   - `bool soundEnabled = true`\n   - `uint16_t sleepTimeoutSecs = 300` (0 = disabled)\n   - `load(Preferences\u0026)`, `save(Preferences\u0026)`\n\n**NVS Schema** (namespace \"mtg\"):\n- \"playerCnt\" (uint8), \"startLife\" (int16)\n- \"p1name\"...\"p6name\" (string, max 15 chars)\n- \"p1life\"...\"p6life\" (int16)\n\n**NVS Schema** (namespace \"settings\"):\n- \"soundOn\" (bool), \"sleepSecs\" (uint16)\n\n**Error Handling**:\n- Read failure: use defaults, log warning\n- Write failure: retry once, log error, continue\n\n**Files to create**:\n- `src/models/Player.hpp` (~30 lines)\n- `src/models/GameState.hpp` (~25 lines)\n- `src/models/GameState.cpp` (~80 lines)\n- `src/models/Settings.hpp` (~20 lines)\n- `src/models/Settings.cpp` (~40 lines)\n\n**Acceptance criteria**:\n- [ ] All structs compile\n- [ ] GameState::save() then load() round-trips correctly\n- [ ] Settings::save() then load() round-trips correctly\n- [ ] adjustLife() clamps to valid range\n- [ ] Default values are sensible (2 players, 20 life, sound on, 5min sleep)","status":"closed","priority":0,"issue_type":"task","owner":"stuart.bradley@wagestream.co.uk","created_at":"2026-01-14T19:18:11.410164Z","created_by":"Stuart Bradley","updated_at":"2026-01-14T19:35:10.407306Z","closed_at":"2026-01-14T19:35:10.407306Z","close_reason":"Data models implemented: Player, GameState, Settings structs with NVS persistence. Compilation successful.","dependencies":[{"issue_id":"m5-paper-s3-mtg-life-counter-4pz","depends_on_id":"m5-paper-s3-mtg-life-counter-v7m","type":"blocks","created_at":"2026-01-14T19:20:34.795092Z","created_by":"Stuart Bradley"}]}
{"id":"m5-paper-s3-mtg-life-counter-70s","title":"PlayerCard component: sprite-buffered life display with buttons","description":"**Plan**: /Users/stuart/.claude/plans/parallel-fluttering-stream.md (Epic 4)\n\n**Goal**: Create PlayerCard component with sprite-buffered life display for fast updates.\n\n**What to implement**:\n\n**PlayerCard** (`src/ui/PlayerCard.hpp/cpp`):\n- Extends Component\n- Constructor: `PlayerCard(Player* player, std::function\u003cvoid()\u003e onNameTap)`\n- Uses LGFX_Sprite for double-buffered partial updates\n\n**Visual layout** (fits in ~320x200 or flexible based on player count):\n```\n┌──────────────────────┐\n│  [Player Name]       │  \u003c- tap to edit\n│                      │\n│      [ 20 ]          │  \u003c- LARGE life total\n│                      │\n│  [-5] [-1] [+1] [+5] │  \u003c- life adjustment buttons\n└──────────────────────┘\n```\n\n**Memory**: \n- Sprite buffer: ~320x200x1 byte = 64KB per card\n- Max 6 cards = 384KB (fits in 8MB PSRAM)\n\n**Behavior**:\n- `setPlayer(Player* p)` - update player reference\n- `draw()` - renders to sprite, pushes to display with epd_fastest\n- Life buttons call `player-\u003eadjustLife(delta)` + Sound::lifeUp/Down\n- Name tap triggers callback (parent shows keyboard)\n- Mark dirty only when life changes\n\n**Files to create**:\n- `src/ui/PlayerCard.hpp` (~40 lines)\n- `src/ui/PlayerCard.cpp` (~150 lines)\n\n**Dependencies**: \n- Component base class\n- Player model\n- Sound utilities\n\n**Acceptance criteria**:\n- [ ] Life total displays prominently\n- [ ] Player name displays\n- [ ] +1, -1, +5, -5 buttons work\n- [ ] Life changes trigger appropriate sound\n- [ ] Tapping name area triggers callback\n- [ ] Partial refresh is noticeably fast (not full screen flash)","status":"closed","priority":1,"issue_type":"task","owner":"stuart.bradley@wagestream.co.uk","created_at":"2026-01-14T19:19:27.426454Z","created_by":"Stuart Bradley","updated_at":"2026-01-14T19:44:07.744517Z","closed_at":"2026-01-14T19:44:07.744517Z","close_reason":"Components implemented and compilation successful.","dependencies":[{"issue_id":"m5-paper-s3-mtg-life-counter-70s","depends_on_id":"m5-paper-s3-mtg-life-counter-sho","type":"blocks","created_at":"2026-01-14T19:20:48.616151Z","created_by":"Stuart Bradley"},{"issue_id":"m5-paper-s3-mtg-life-counter-70s","depends_on_id":"m5-paper-s3-mtg-life-counter-o2w","type":"blocks","created_at":"2026-01-14T19:20:48.750677Z","created_by":"Stuart Bradley"},{"issue_id":"m5-paper-s3-mtg-life-counter-70s","depends_on_id":"m5-paper-s3-mtg-life-counter-4pz","type":"blocks","created_at":"2026-01-14T19:20:48.866816Z","created_by":"Stuart Bradley"}]}
{"id":"m5-paper-s3-mtg-life-counter-79t","title":"Power management: inactivity timer, IMU wake, auto-sleep","description":"**Plan**: /Users/stuart/.claude/plans/parallel-fluttering-stream.md (Epic 6)\n\n**Goal**: Implement power management with auto-sleep and motion wake.\n\n**What to implement**:\n\n**Power utilities** (`src/utils/Power.hpp/cpp`):\n- `void init()` - initialize IMU for motion detection\n- `void resetInactivityTimer()` - called on any touch/interaction\n- `void checkInactivity(uint16_t timeoutSecs)` - check if should sleep\n- `void powerOff()` - configure IMU wake interrupt, call M5.Power.powerOff()\n\n**Main loop integration** (updates to `src/main.cpp`):\n- Call `Power::resetInactivityTimer()` on any touch event\n- Call `Power::checkInactivity(settings.sleepTimeoutSecs)` in loop\n- When timeout reached and timeoutSecs \u003e 0: save state, power off\n\n**IMU wake configuration**:\n- Configure BMI270 for any-motion interrupt\n- Set threshold low enough that picking up device triggers wake\n- IMU interrupt goes to PMS150 power chip -\u003e device powers on\n- This achieves ~9.6uA power draw vs 5.1mA for ESP32 deep sleep\n\n**Error handling**:\n- IMU init fails: disable auto-sleep, log warning (device stays on)\n- Save failure before sleep: retry once, then sleep anyway (don't hang)\n\n**Files to create**:\n- `src/utils/Power.hpp` (~20 lines)\n- `src/utils/Power.cpp` (~80 lines)\n\n**Files to update**:\n- `src/main.cpp` - add inactivity tracking in loop\n\n**Dependencies**:\n- Settings model (for sleepTimeoutSecs)\n- GameState model (for save before sleep)\n- Hardware validation (Epic 0 proved IMU wake works)\n\n**Acceptance criteria**:\n- [ ] Device powers off after configured inactivity period\n- [ ] Picking up device powers it back on\n- [ ] timeout=0 disables auto-sleep\n- [ ] Game state saved before power-off\n- [ ] Any touch resets inactivity timer","status":"open","priority":2,"issue_type":"task","owner":"stuart.bradley@wagestream.co.uk","created_at":"2026-01-14T19:20:14.355875Z","created_by":"Stuart Bradley","updated_at":"2026-01-14T19:20:14.355875Z","dependencies":[{"issue_id":"m5-paper-s3-mtg-life-counter-79t","depends_on_id":"m5-paper-s3-mtg-life-counter-4pz","type":"blocks","created_at":"2026-01-14T19:21:07.701355Z","created_by":"Stuart Bradley"},{"issue_id":"m5-paper-s3-mtg-life-counter-79t","depends_on_id":"m5-paper-s3-mtg-life-counter-v7m","type":"blocks","created_at":"2026-01-14T19:21:07.839293Z","created_by":"Stuart Bradley"}]}
{"id":"m5-paper-s3-mtg-life-counter-o2w","title":"Sound utilities: buzzer tones for UI feedback","description":"**Plan**: /Users/stuart/.claude/plans/parallel-fluttering-stream.md (Epic 2)\n\n**Goal**: Create sound utilities for tonal feedback.\n\n**What to implement**:\n\n**Sound** (`src/utils/Sound.hpp/cpp`):\n- `namespace Sound` or static class\n- `void init()` - initialize speaker\n- `void click()` - short click sound for button press\n- `void lifeUp()` - ascending tone for +life\n- `void lifeDown()` - descending tone for -life  \n- `void alert()` - attention-getting tone\n- `void setEnabled(bool enabled)` - respects settings\n- Internal: uses M5.Speaker.tone() with different frequencies/durations\n\n**Tone suggestions**:\n- Click: 1000Hz, 20ms\n- LifeUp: 800Hz-\u003e1200Hz sweep, 50ms\n- LifeDown: 1200Hz-\u003e800Hz sweep, 50ms\n- Alert: 500Hz, 200ms\n\n**Files to create**:\n- `src/utils/Sound.hpp` (~20 lines)\n- `src/utils/Sound.cpp` (~50 lines)\n\n**Dependencies**: None (hardware validated in Epic 0)\n\n**Acceptance criteria**:\n- [ ] All four tones play distinct sounds\n- [ ] setEnabled(false) silences all tones\n- [ ] Tones don't block (non-blocking playback)","status":"closed","priority":1,"issue_type":"task","owner":"stuart.bradley@wagestream.co.uk","created_at":"2026-01-14T19:18:40.403677Z","created_by":"Stuart Bradley","updated_at":"2026-01-14T19:39:28.87188Z","closed_at":"2026-01-14T19:39:28.87188Z","close_reason":"Sound utilities implemented: click(), lifeUp(), lifeDown(), alert() with enable/disable toggle. Compilation successful.","dependencies":[{"issue_id":"m5-paper-s3-mtg-life-counter-o2w","depends_on_id":"m5-paper-s3-mtg-life-counter-v7m","type":"blocks","created_at":"2026-01-14T19:20:35.019376Z","created_by":"Stuart Bradley"}]}
{"id":"m5-paper-s3-mtg-life-counter-qj1","title":"Keyboard component: on-screen QWERTY for name editing","description":"**Plan**: /Users/stuart/.claude/plans/parallel-fluttering-stream.md (Epic 2)\n\n**Goal**: Create on-screen QWERTY keyboard for editing player names.\n\n**What to implement**:\n\n**Keyboard** (`src/ui/Keyboard.hpp/cpp`):\n- Extends Component  \n- Callback-based: `using Callback = std::function\u003cvoid(const char* result, bool confirmed)\u003e`\n- Constructor: `Keyboard(const char* initialText, Callback onComplete)`\n\n**Layout** (960x200px, bottom of screen):\n```\nQ  W  E  R  T  Y  U  I  O  P  \u003c-\nA  S  D  F  G  H  J  K  L  '\n^  Z  X  C  V  B  N  M  .  ^\n[123]  [____SPACE____]  [DONE]  [CANCEL]\n```\n\n**Key sizes**:\n- Letter keys: 70x45px (large touch targets)\n- Space bar: 400x45px\n- Action buttons (DONE/CANCEL): 100x45px\n- Backspace (\u003c-): 70x45px\n\n**State**:\n- `char _buffer[16]` - max 15 chars + null\n- `uint8_t _cursorPos`\n- `bool _shifted` - for uppercase\n- Shift toggles on each letter (auto-unshift after typing)\n\n**Behavior**:\n- Show text preview above keyboard\n- DONE calls callback with (buffer, true)\n- CANCEL calls callback with (original, false)\n- [123] toggles number row (bonus, can defer if complex)\n\n**Files to create**:\n- `src/ui/Keyboard.hpp` (~40 lines)\n- `src/ui/Keyboard.cpp` (~150 lines)\n\n**Dependencies**: Requires Component base class\n\n**Acceptance criteria**:\n- [ ] All letter keys work\n- [ ] Shift toggles uppercase\n- [ ] Backspace deletes\n- [ ] Space adds space\n- [ ] DONE returns edited text with confirmed=true\n- [ ] CANCEL returns original text with confirmed=false\n- [ ] Text preview shows current buffer","status":"closed","priority":1,"issue_type":"task","owner":"stuart.bradley@wagestream.co.uk","created_at":"2026-01-14T19:19:02.281436Z","created_by":"Stuart Bradley","updated_at":"2026-01-14T19:44:07.768753Z","closed_at":"2026-01-14T19:44:07.768753Z","close_reason":"Components implemented and compilation successful.","dependencies":[{"issue_id":"m5-paper-s3-mtg-life-counter-qj1","depends_on_id":"m5-paper-s3-mtg-life-counter-sho","type":"blocks","created_at":"2026-01-14T19:20:39.921819Z","created_by":"Stuart Bradley"}]}
{"id":"m5-paper-s3-mtg-life-counter-sho","title":"UI framework: Component, Screen base classes, ScreenManager","description":"**Plan**: /Users/stuart/.claude/plans/parallel-fluttering-stream.md (Epic 1)\n\n**Goal**: Create the core UI framework that all screens and components will use.\n\n**What to implement**:\n\n1. **Component base class** (`src/ui/Component.hpp`):\n   - `struct Rect { int16_t x, y, w, h; }` - bounds rectangle\n   - `bool _dirty` flag for redraw tracking\n   - `virtual void draw(M5GFX* gfx)` \n   - `virtual bool handleTouch(const m5::touch_detail_t\u0026 touch)`\n   - `bool contains(int16_t x, int16_t y)` - hit testing\n\n2. **Screen base class** (`src/ui/Screen.hpp`):\n   - `virtual void onEnter()`, `virtual void onExit()`\n   - `virtual void update()`, `virtual void draw(M5GFX* gfx)`\n   - `virtual bool handleTouch(const m5::touch_detail_t\u0026 touch)`\n\n3. **ScreenManager** (`src/app/ScreenManager.hpp/cpp`):\n   - Holds current and previous screen pointers (no stack needed)\n   - `setScreen(Screen* newScreen)` - calls onExit/onEnter\n   - `goBack()` - returns to previous screen\n   - `getCurrentScreen()`, `update()`, `draw()`\n\n**Design decisions**:\n- Pass M5GFX* (or LovyanGFX*) for drawing\n- 150ms touch debounce at component level\n- Dirty flag pattern for efficient redraws\n\n**Files to create**:\n- `src/ui/Component.hpp` (~50 lines)\n- `src/ui/Screen.hpp` (~35 lines)\n- `src/app/ScreenManager.hpp` (~25 lines)\n- `src/app/ScreenManager.cpp` (~50 lines)\n\n**Acceptance criteria**:\n- [ ] All classes compile\n- [ ] Component::contains() correctly reports hits inside/outside bounds\n- [ ] ScreenManager::setScreen() calls onExit on old, onEnter on new\n- [ ] ScreenManager::goBack() works (current becomes old, old becomes current)","status":"closed","priority":0,"issue_type":"task","owner":"stuart.bradley@wagestream.co.uk","created_at":"2026-01-14T19:18:22.753957Z","created_by":"Stuart Bradley","updated_at":"2026-01-14T19:36:47.593042Z","closed_at":"2026-01-14T19:36:47.593042Z","close_reason":"UI framework implemented: Component base class with Rect/dirty flag, Screen base class with lifecycle methods, ScreenManager with setScreen/goBack. Compilation successful.","dependencies":[{"issue_id":"m5-paper-s3-mtg-life-counter-sho","depends_on_id":"m5-paper-s3-mtg-life-counter-v7m","type":"blocks","created_at":"2026-01-14T19:20:34.910029Z","created_by":"Stuart Bradley"}]}
{"id":"m5-paper-s3-mtg-life-counter-tdp","title":"Toolbar component: battery, time, WiFi stub","description":"**Plan**: /Users/stuart/.claude/plans/parallel-fluttering-stream.md (Epic 2)\n\n**Goal**: Create system toolbar that appears on all screens.\n\n**What to implement**:\n\n**Toolbar** (`src/ui/Toolbar.hpp/cpp`):\n- Extends Component\n- Fixed height ~40px at top of screen\n- Displays:\n  - Battery percentage + icon (from M5.Power.getBatteryLevel())\n  - Current time from RTC (from M5.Rtc.getDateTime())\n  - WiFi indicator (stub - just show \"---\" or empty, WiFi deferred to future)\n- Auto-updates on draw() (reads fresh values)\n\n**Layout** (960px wide):\n```\n[WiFi stub: 60px] [Time: HH:MM centered] [Battery: XX% + icon: 80px]\n```\n\n**Files to create**:\n- `src/ui/Toolbar.hpp` (~25 lines)\n- `src/ui/Toolbar.cpp` (~60 lines)\n\n**Dependencies**: Requires Component base class\n\n**Acceptance criteria**:\n- [ ] Shows battery percentage (updates on each draw)\n- [ ] Shows time from RTC (format HH:MM)\n- [ ] WiFi area shows placeholder (no crash)\n- [ ] Toolbar renders cleanly at top of display","status":"closed","priority":1,"issue_type":"task","owner":"stuart.bradley@wagestream.co.uk","created_at":"2026-01-14T19:18:49.65094Z","created_by":"Stuart Bradley","updated_at":"2026-01-14T19:44:07.719846Z","closed_at":"2026-01-14T19:44:07.719846Z","close_reason":"Components implemented and compilation successful.","dependencies":[{"issue_id":"m5-paper-s3-mtg-life-counter-tdp","depends_on_id":"m5-paper-s3-mtg-life-counter-sho","type":"blocks","created_at":"2026-01-14T19:20:39.803979Z","created_by":"Stuart Bradley"}]}
{"id":"m5-paper-s3-mtg-life-counter-v21","title":"Investigate IMU wake-from-poweroff not triggering","description":"**Context**: During hardware validation (m5-paper-s3-mtg-life-counter-v7m), IMU wake from power-off did not work.\n\n**What happened**:\n- IMU (BMI270) initializes and reads correctly: X=0.01, Y=0.01, Z=-1.00\n- Device powers off via M5.Power.powerOff()\n- Moving/picking up device does NOT trigger wake\n\n**Investigation needed**:\n1. Check if M5Paper S3 hardware supports IMU-\u003ePMS150 wake path\n2. Review M5Unified examples for motion wake configuration\n3. May need explicit BMI270 interrupt configuration before powerOff()\n4. Check if different power-off method needed (deep sleep vs full poweroff)\n\n**Impact**: P3 - Nice-to-have feature, not blocking MVP. Fallback is button-press wake only.\n\n**References**:\n- Hardware validation test code: src/main.cpp (temporary, will be replaced)\n- Related issue: m5-paper-s3-mtg-life-counter-79t (power management)","status":"open","priority":3,"issue_type":"bug","owner":"stuart.bradley@wagestream.co.uk","created_at":"2026-01-14T19:33:01.841003Z","created_by":"Stuart Bradley","updated_at":"2026-01-14T19:33:01.841003Z"}
{"id":"m5-paper-s3-mtg-life-counter-v7m","title":"Hardware validation: test IMU wake, NVS, buzzer, e-ink refresh","description":"**Plan**: /Users/stuart/.claude/plans/parallel-fluttering-stream.md (Epic 0)\n\n**Goal**: Validate all hardware features work before building app layer.\n\n**What to implement**:\n1. Test IMU motion wake: configure BMI270, power off, verify wake on movement\n2. Test NVS read/write cycle with Preferences library\n3. Test buzzer tones via M5.Speaker\n4. Test e-ink partial refresh speed with epd_fastest mode\n\n**Where**: `src/main.cpp` (temporary test code, will be replaced)\n\n**Files to read**: M5Unified library examples for IMU, Speaker, Display APIs\n**Files to write**: `src/main.cpp` (~100 lines of test code)\n\n**Acceptance criteria**:\n- [ ] IMU wake from power-off works (manual test: pick up device)\n- [ ] NVS write then read returns correct value\n- [ ] Buzzer plays different frequency tones\n- [ ] Partial refresh visibly faster than full refresh\n- [ ] All tests logged to serial monitor\n\n**Exit criteria**: All hardware features work in isolation. Document any gotchas for later.","status":"closed","priority":0,"issue_type":"task","owner":"stuart.bradley@wagestream.co.uk","created_at":"2026-01-14T19:17:52.495803Z","created_by":"Stuart Bradley","updated_at":"2026-01-14T19:32:41.813566Z","closed_at":"2026-01-14T19:32:41.813566Z","close_reason":"Hardware validation complete. NVS: PASS, Buzzer: PASS (4 tones confirmed), E-ink: PASS (display() is async - returns immediately), Touch: PASS, IMU: reads correctly but wake-from-poweroff not working. Core hardware ready for app development."}
{"id":"m5-paper-s3-mtg-life-counter-xgr","title":"Home screen: app launcher with Settings and MTG icons","description":"**Plan**: /Users/stuart/.claude/plans/parallel-fluttering-stream.md (Epic 3)\n\n**Goal**: Create home screen launcher that displays app icons and launches apps.\n\n**What to implement**:\n\n1. **HomeScreen** (`src/ui/screens/HomeScreen.hpp/cpp`):\n   - Extends Screen\n   - Shows Toolbar at top\n   - 2-icon grid: Settings (gear), MTG Life Counter\n   - Touch on icon launches corresponding screen\n   - Uses ScreenManager to switch screens\n\n2. **Icons** (`src/assets/icons.hpp`):\n   - `const uint8_t ICON_SETTINGS[]` - 6-spoke gear, 64x64 or 80x80\n   - `const uint8_t ICON_MTG[]` - simplified MTG logo or card icon, 64x64 or 80x80\n   - Format: 1-bit or grayscale bitmap as const array\n\n**Layout** (960x540):\n```\n[Toolbar: 40px]\n[                                    ]\n[    [Settings]     [MTG]            ]\n[     Settings    Life Counter       ]\n[                                    ]\n```\n\n- Icons centered in cards with label below\n- Cards ~200x180px each, centered horizontally\n- Generous spacing for touch targets\n\n**Files to create**:\n- `src/ui/screens/HomeScreen.hpp` (~30 lines)\n- `src/ui/screens/HomeScreen.cpp` (~80 lines)\n- `src/assets/icons.hpp` (~100 lines for icon data)\n\n**Update**:\n- `src/main.cpp` - set HomeScreen as initial screen\n\n**Dependencies**: \n- Component, Screen, ScreenManager (UI framework)\n- Toolbar component\n\n**Acceptance criteria**:\n- [ ] Home screen displays on boot\n- [ ] Toolbar shows at top with battery/time\n- [ ] Two app icons visible with labels\n- [ ] Tap Settings icon -\u003e navigates to SettingsScreen (stub OK for now)\n- [ ] Tap MTG icon -\u003e navigates to MTGLifeScreen (stub OK for now)","status":"open","priority":1,"issue_type":"feature","owner":"stuart.bradley@wagestream.co.uk","created_at":"2026-01-14T19:19:14.741455Z","created_by":"Stuart Bradley","updated_at":"2026-01-14T20:13:38.243516Z","dependencies":[{"issue_id":"m5-paper-s3-mtg-life-counter-xgr","depends_on_id":"m5-paper-s3-mtg-life-counter-sho","type":"blocks","created_at":"2026-01-14T19:20:44.013871Z","created_by":"Stuart Bradley"},{"issue_id":"m5-paper-s3-mtg-life-counter-xgr","depends_on_id":"m5-paper-s3-mtg-life-counter-tdp","type":"blocks","created_at":"2026-01-14T19:20:44.167528Z","created_by":"Stuart Bradley"}]}
{"id":"m5-paper-s3-mtg-life-counter-zis","title":"System Settings Screen: sound toggle, sleep timeout","description":"**Plan**: /Users/stuart/.claude/plans/parallel-fluttering-stream.md (Epic 5)\n\n**Goal**: Create system-wide settings app.\n\n**What to implement**:\n\n**SettingsScreen** (`src/ui/screens/SettingsScreen.hpp/cpp`):\n- Extends Screen\n- Back button to return to HomeScreen\n\n**Settings rows**:\n1. **Sound**: [ON] [OFF] toggle\n2. **Auto-Sleep**: [Off] [1min] [5min] [10min] selector\n\n**Layout** (960x540):\n```\n[Toolbar]\n[\u003c Back]                Settings\n\nSound:        [ON]  [OFF]\n\nAuto-Sleep:   [Off] [1m] [5m] [10m]\n\n```\n\n**Behavior**:\n- Sound toggle: updates Settings.soundEnabled, calls Sound::setEnabled()\n- Sleep selector: updates Settings.sleepTimeoutSecs (0/60/300/600)\n- Back: save settings to NVS, return to home\n\n**Files to create**:\n- `src/ui/screens/SettingsScreen.hpp` (~30 lines)\n- `src/ui/screens/SettingsScreen.cpp` (~120 lines)\n\n**Dependencies**:\n- Screen, ScreenManager\n- Button component\n- Settings model\n- Toolbar component\n- Sound utilities\n\n**Acceptance criteria**:\n- [ ] Sound toggle changes Sound::setEnabled state\n- [ ] Sound toggle persists after app restart\n- [ ] Sleep timeout selector works\n- [ ] Sleep timeout persists after app restart\n- [ ] Back returns to home screen","status":"open","priority":2,"issue_type":"feature","owner":"stuart.bradley@wagestream.co.uk","created_at":"2026-01-14T19:20:00.104291Z","created_by":"Stuart Bradley","updated_at":"2026-01-14T19:20:00.104291Z","dependencies":[{"issue_id":"m5-paper-s3-mtg-life-counter-zis","depends_on_id":"m5-paper-s3-mtg-life-counter-xgr","type":"blocks","created_at":"2026-01-14T19:21:02.89667Z","created_by":"Stuart Bradley"},{"issue_id":"m5-paper-s3-mtg-life-counter-zis","depends_on_id":"m5-paper-s3-mtg-life-counter-0g5","type":"blocks","created_at":"2026-01-14T19:21:03.043522Z","created_by":"Stuart Bradley"},{"issue_id":"m5-paper-s3-mtg-life-counter-zis","depends_on_id":"m5-paper-s3-mtg-life-counter-4pz","type":"blocks","created_at":"2026-01-14T19:21:03.170718Z","created_by":"Stuart Bradley"},{"issue_id":"m5-paper-s3-mtg-life-counter-zis","depends_on_id":"m5-paper-s3-mtg-life-counter-o2w","type":"blocks","created_at":"2026-01-14T19:21:03.287442Z","created_by":"Stuart Bradley"}]}
