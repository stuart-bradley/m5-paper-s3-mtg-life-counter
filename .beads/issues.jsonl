{"id":"m5-paper-s3-mtg-life-counter-01c","title":"Add battery percentage to system toolbar","description":"**Context**: The UI mockup shows battery status as `[████░░] 67%` in the toolbar, but current implementation only shows time.\n\n**Requirements**:\n- Display battery level as ASCII bar graph (e.g., `[████░░]`)\n- Show percentage number next to bar\n- Use M5Unified battery API to get charge level\n- Update periodically (every minute or on toolbar redraw)\n\n**References**:\n- UI mockup: `ui-mockup/index.html:883` shows format `[████░░] 67%`\n- Toolbar implementation: `src/ui/Toolbar.cpp`\n- M5Unified docs for battery: `M5.Power.getBatteryLevel()`","status":"closed","priority":2,"issue_type":"feature","owner":"stuart.bradley@wagestream.co.uk","created_at":"2026-01-15T18:39:50.559521Z","created_by":"Stuart Bradley","updated_at":"2026-01-15T18:42:43.818703Z","closed_at":"2026-01-15T18:42:43.818703Z","close_reason":"Implemented battery bar graph [####--] format in Toolbar.cpp"}
{"id":"m5-paper-s3-mtg-life-counter-0g5","title":"Button component with touch debounce","description":"**Plan**: /Users/stuart/.claude/plans/parallel-fluttering-stream.md (Epic 2)\n\n**Goal**: Create reusable Button component with proper touch handling.\n\n**What to implement**:\n\n**Button** (`src/ui/Button.hpp/cpp`):\n- Extends Component\n- `Button(Rect bounds, const char* label, std::function\u003cvoid()\u003e onClick)`\n- 150ms debounce between activations\n- Visual states: normal, pressed\n- `draw()` - renders button with label, inverted when pressed\n- `handleTouch()` - uses wasClicked() not isPressed(), fires callback\n\n**Design**:\n- Large touch targets (min 80x80 per plan)\n- High contrast for e-ink: black border, white fill, black text\n- Pressed state: inverted colors\n\n**Files to create**:\n- `src/ui/Button.hpp` (~30 lines)\n- `src/ui/Button.cpp` (~60 lines)\n\n**Dependencies**: Requires Component base class\n\n**Acceptance criteria**:\n- [ ] Button renders with label\n- [ ] Touch inside bounds triggers callback\n- [ ] Touch outside bounds ignored\n- [ ] Rapid taps debounced (only one callback per 150ms)\n- [ ] Visual feedback on press","status":"closed","priority":1,"issue_type":"task","owner":"stuart.bradley@wagestream.co.uk","created_at":"2026-01-14T19:18:31.603147Z","created_by":"Stuart Bradley","updated_at":"2026-01-14T19:37:59.807389Z","closed_at":"2026-01-14T19:37:59.807389Z","close_reason":"Button component implemented: extends Component, 150ms debounce, visual pressed state (inverted colors), centered label. Compilation successful.","dependencies":[{"issue_id":"m5-paper-s3-mtg-life-counter-0g5","depends_on_id":"m5-paper-s3-mtg-life-counter-sho","type":"blocks","created_at":"2026-01-14T19:20:39.661533Z","created_by":"Stuart Bradley"}]}
{"id":"m5-paper-s3-mtg-life-counter-0in","title":"Add logging macros and unit tests","description":"Add Log.hpp macros and native unit tests for core logic.\n\n**Plan reference**: /Users/stuart/.claude/plans/velvety-tinkering-brooks.md (lines 510-545)\n**Depends on**: m5-paper-s3-mtg-life-counter-ncc (Navigation Refactor)\n\n## Implementation\n\n1. Create src/utils/Log.hpp (plan lines 514-528):\n   - LOG_E/W/I/D macros, conditional on DEBUG\n\n2. Update platformio.ini:\n   - Add build_flags = -DDEBUG to dev env\n   - Add release env without DEBUG\n\n3. Replace Serial.print* with LOG_* throughout codebase\n\n4. Set up native test environment:\n   - Add [env:native] to platformio.ini\n   - Create test/ directory\n\n5. Add unit tests:\n   - Player::adjustLife() bounds (0-9999)\n   - GameState player count (2-6)\n   - Rect::contains() geometry\n   - AppRegistry::findApp() null for unknown\n\n## Acceptance Criteria\n- [ ] pio test -e native passes\n- [ ] No raw Serial.print* calls remain\n- [ ] DEBUG/release builds work","status":"open","priority":2,"issue_type":"task","owner":"stuart.bradley@wagestream.co.uk","created_at":"2026-01-15T19:38:31.012057Z","created_by":"Stuart Bradley","updated_at":"2026-01-15T19:38:31.012057Z","dependencies":[{"issue_id":"m5-paper-s3-mtg-life-counter-0in","depends_on_id":"m5-paper-s3-mtg-life-counter-ncc","type":"blocks","created_at":"2026-01-15T19:38:31.013544Z","created_by":"Stuart Bradley"}]}
{"id":"m5-paper-s3-mtg-life-counter-1km","title":"Fix back button navigation to use explicit screen targets","description":"## Problem\nWhen the app boots and restores the last screen from preferences, the `_previous` pointer in ScreenManager is null. This causes `goBack()` to do nothing, breaking back buttons on screens like MTGSettingsScreen.\n\n## Root Cause\nBack buttons currently call `_manager-\u003egoBack()` which relies on `_previous` being set. But when the app restores a screen from preferences on boot, there's no navigation history.\n\n## Solution\nEach screen's back button should navigate to a specific target screen instead of relying on `goBack()`:\n- MTGSettingsScreen: Back → MTGLifeScreen\n- WiFiScreen: Back → SystemSettingsScreen  \n- SystemSettingsScreen: Back → HomeScreen\n\n## Files to Modify\n- `src/ui/screens/MTGSettingsScreen.cpp` - Change back button to use `setScreen()` with explicit target\n- `src/ui/screens/WiFiScreen.cpp` - Already uses explicit target (line 17-20)\n- `src/ui/screens/SystemSettingsScreen.cpp` - Already uses explicit target (line 15-19)\n\n## Also Clean Up\nRemove debug logging added during investigation:\n- `src/ui/HeaderBar.cpp:63-66,69` - Remove Serial.printf debug statements\n- `src/app/ScreenManager.cpp:62,64-65,69,78` - Remove Serial.printf debug statements\n\n## Testing\n1. Boot device fresh (or after being on MTGSettingsScreen)\n2. Navigate to MTG Life Counter → Settings\n3. Press Back button\n4. Should return to MTG Life Counter screen","status":"closed","priority":0,"issue_type":"bug","owner":"stuart.bradley@wagestream.co.uk","created_at":"2026-01-21T11:02:00.900894Z","created_by":"Stuart Bradley","updated_at":"2026-01-21T11:03:46.149126Z","closed_at":"2026-01-21T11:03:46.149126Z","close_reason":"Fixed MTGSettingsScreen back button to use explicit screen target (setLifeScreen pattern) instead of goBack(). Removed debug logging from HeaderBar.cpp and ScreenManager.cpp. Build verified. Awaiting device testing."}
{"id":"m5-paper-s3-mtg-life-counter-1x5","title":"MTG Life Screen: dynamic grid layout for 2-6 players","description":"**Plan**: /Users/stuart/.claude/plans/parallel-fluttering-stream.md (Epic 4)\n\n**Goal**: Create main MTG life counter screen with dynamic player layouts.\n\n**What to implement**:\n\n**MTGLifeScreen** (`src/ui/screens/MTGLifeScreen.hpp/cpp`):\n- Extends Screen\n- Holds GameState reference, array of PlayerCard components\n- Toolbar at top, gear icon to open MTGSettingsScreen\n- Dynamic grid based on player count\n\n**Layouts** (960x500 usable area below toolbar):\n- 2 players: 2 cards side by side (480x400 each)\n- 3 players: 3 cards in row (320x400 each)\n- 4 players: 2x2 grid (480x200 each)\n- 5 players: 3 top, 2 bottom (320x200 each)\n- 6 players: 3x2 grid (320x200 each)\n\n**Behavior**:\n- `onEnter()` - load GameState from NVS, create PlayerCards\n- When player count changes (from settings), recreate layout\n- Gear icon tap -\u003e ScreenManager::setScreen(MTGSettingsScreen)\n- Player name tap -\u003e show Keyboard overlay, update name on confirm\n- Auto-save to NVS periodically (every 5 seconds if dirty) or on exit\n\n**Keyboard integration**:\n- When name tapped, show Keyboard component as overlay\n- On confirm, update player name, hide keyboard, save state\n\n**Files to create**:\n- `src/ui/screens/MTGLifeScreen.hpp` (~40 lines)\n- `src/ui/screens/MTGLifeScreen.cpp` (~200 lines)\n\n**Dependencies**:\n- Screen, ScreenManager\n- PlayerCard component\n- Keyboard component\n- GameState model\n- Toolbar component\n\n**Acceptance criteria**:\n- [ ] Displays correct number of PlayerCards based on playerCount\n- [ ] All life buttons work for all players\n- [ ] Tapping name opens keyboard, editing works\n- [ ] Gear icon navigates to settings\n- [ ] Game state auto-saves\n- [ ] Layout adapts correctly for 2/3/4/5/6 players","status":"closed","priority":1,"issue_type":"feature","owner":"stuart.bradley@wagestream.co.uk","created_at":"2026-01-14T19:19:40.549334Z","created_by":"Stuart Bradley","updated_at":"2026-01-14T20:12:51.02971Z","closed_at":"2026-01-14T20:12:51.02971Z","close_reason":"Core functionality complete: life buttons, name editing, keyboard, auto-save all working","dependencies":[{"issue_id":"m5-paper-s3-mtg-life-counter-1x5","depends_on_id":"m5-paper-s3-mtg-life-counter-70s","type":"blocks","created_at":"2026-01-14T19:20:53.466561Z","created_by":"Stuart Bradley"},{"issue_id":"m5-paper-s3-mtg-life-counter-1x5","depends_on_id":"m5-paper-s3-mtg-life-counter-qj1","type":"blocks","created_at":"2026-01-14T19:20:53.596588Z","created_by":"Stuart Bradley"},{"issue_id":"m5-paper-s3-mtg-life-counter-1x5","depends_on_id":"m5-paper-s3-mtg-life-counter-tdp","type":"blocks","created_at":"2026-01-14T19:20:53.710636Z","created_by":"Stuart Bradley"}]}
{"id":"m5-paper-s3-mtg-life-counter-2jm","title":"Add numbers/symbols mode to Keyboard component","description":"**Problem**: WiFi passwords require numbers and special characters, but the Keyboard component only has letters.\n\n**Solution**: Add a numbers/symbols toggle mode:\n- Replace left shift key with \"123\" button to toggle to numbers mode\n- Numbers mode layout:\n  - Row 0: 1234567890 + backspace\n  - Row 1: -/:;()$\u0026@\"\n  - Row 2: ABC + .,?!' + more symbols\n  - Row 3: SPACE, DONE, CANCEL (unchanged)\n- \"ABC\" button in numbers mode returns to letters\n- Also increase MAX_TEXT_LEN from 15 to 32 for WiFi passwords\n\n**Files**:\n- `src/ui/Keyboard.hpp` - Add `_numMode` bool, increase MAX_TEXT_LEN\n- `src/ui/Keyboard.cpp` - Add number/symbol row layouts, toggle logic","status":"closed","priority":1,"issue_type":"bug","owner":"stuart.bradley@wagestream.co.uk","created_at":"2026-01-15T18:50:23.268399Z","created_by":"Stuart Bradley","updated_at":"2026-01-15T18:53:03.357337Z","closed_at":"2026-01-15T18:53:03.357337Z","close_reason":"Implemented numbers/symbols mode with 123/ABC toggle button, increased MAX_TEXT_LEN to 32"}
{"id":"m5-paper-s3-mtg-life-counter-39s","title":"MTG Settings Screen: player count, starting life, reset game","description":"**Plan**: /Users/stuart/.claude/plans/parallel-fluttering-stream.md (Epic 4)\n\n**Goal**: Create settings screen for MTG game configuration.\n\n**What to implement**:\n\n**MTGSettingsScreen** (`src/ui/screens/MTGSettingsScreen.hpp/cpp`):\n- Extends Screen\n- Back button to return to MTGLifeScreen\n\n**Settings rows**:\n1. **Player Count**: [2] [3] [4] [5] [6] - radio buttons\n2. **Starting Life**: [20] [25] [30] [40] - radio buttons\n3. **Reset Game**: [Reset Life] - resets all players to starting life\n4. **New Game**: [New Game] - reset life + reset names to defaults\n\n**Layout** (960x540):\n```\n[Toolbar]\n[\u003c Back]\n\nPlayers:    [2] [3] [4] [5] [6]\n\nStarting:   [20] [25] [30] [40]\n\n[  Reset Life  ]   [  New Game  ]\n\n```\n\n**Behavior**:\n- Player count change: update GameState, add/remove players\n- Starting life change: only affects new games, not current life\n- Reset Life: confirm dialog -\u003e reset all to starting life\n- New Game: confirm dialog -\u003e reset life + names (\"Player 1\", etc.)\n- Back: save settings, return to life screen\n\n**Confirm dialog**: Simple modal with [Cancel] [Confirm]\n\n**Files to create**:\n- `src/ui/screens/MTGSettingsScreen.hpp` (~35 lines)\n- `src/ui/screens/MTGSettingsScreen.cpp` (~180 lines)\n\n**Dependencies**:\n- Screen, ScreenManager\n- Button component\n- GameState model\n- Toolbar component\n\n**Acceptance criteria**:\n- [ ] Player count selector works (2-6)\n- [ ] Starting life selector works (20/25/30/40)\n- [ ] Reset Life resets all players to starting life\n- [ ] New Game resets life + names\n- [ ] Both reset actions show confirm dialog\n- [ ] Back returns to life screen\n- [ ] Changes persist after back navigation","status":"closed","priority":1,"issue_type":"feature","owner":"stuart.bradley@wagestream.co.uk","created_at":"2026-01-14T19:19:51.676171Z","created_by":"Stuart Bradley","updated_at":"2026-01-14T20:42:52.908329Z","closed_at":"2026-01-14T20:42:52.908329Z","close_reason":"Implemented MTG Settings Screen with player count, starting life, reset options, and confirm dialogs","dependencies":[{"issue_id":"m5-paper-s3-mtg-life-counter-39s","depends_on_id":"m5-paper-s3-mtg-life-counter-1x5","type":"blocks","created_at":"2026-01-14T19:20:57.559113Z","created_by":"Stuart Bradley"},{"issue_id":"m5-paper-s3-mtg-life-counter-39s","depends_on_id":"m5-paper-s3-mtg-life-counter-0g5","type":"blocks","created_at":"2026-01-14T19:20:57.689521Z","created_by":"Stuart Bradley"}]}
{"id":"m5-paper-s3-mtg-life-counter-4pz","title":"Data models: Player, GameState, Settings with NVS persistence","description":"**Plan**: /Users/stuart/.claude/plans/parallel-fluttering-stream.md (Epic 1)\n\n**Goal**: Create core data models with NVS load/save.\n\n**What to implement**:\n\n1. **Player struct** (`src/models/Player.hpp`):\n   - `char name[16]` - fixed size for NVS simplicity\n   - `int16_t life`\n   - `reset(int16_t startingLife)`, `adjustLife(int16_t delta)` - clamps -999 to 9999\n\n2. **GameState struct** (`src/models/GameState.hpp/cpp`):\n   - `uint8_t playerCount` (2-6), `int16_t startingLife` (20/25/30/40)\n   - `Player players[6]`\n   - `reset()`, `initDefaults()`, `load(Preferences\u0026)`, `save(Preferences\u0026)`\n\n3. **Settings struct** (`src/models/Settings.hpp/cpp`):\n   - `bool soundEnabled = true`\n   - `uint16_t sleepTimeoutSecs = 300` (0 = disabled)\n   - `load(Preferences\u0026)`, `save(Preferences\u0026)`\n\n**NVS Schema** (namespace \"mtg\"):\n- \"playerCnt\" (uint8), \"startLife\" (int16)\n- \"p1name\"...\"p6name\" (string, max 15 chars)\n- \"p1life\"...\"p6life\" (int16)\n\n**NVS Schema** (namespace \"settings\"):\n- \"soundOn\" (bool), \"sleepSecs\" (uint16)\n\n**Error Handling**:\n- Read failure: use defaults, log warning\n- Write failure: retry once, log error, continue\n\n**Files to create**:\n- `src/models/Player.hpp` (~30 lines)\n- `src/models/GameState.hpp` (~25 lines)\n- `src/models/GameState.cpp` (~80 lines)\n- `src/models/Settings.hpp` (~20 lines)\n- `src/models/Settings.cpp` (~40 lines)\n\n**Acceptance criteria**:\n- [ ] All structs compile\n- [ ] GameState::save() then load() round-trips correctly\n- [ ] Settings::save() then load() round-trips correctly\n- [ ] adjustLife() clamps to valid range\n- [ ] Default values are sensible (2 players, 20 life, sound on, 5min sleep)","status":"closed","priority":0,"issue_type":"task","owner":"stuart.bradley@wagestream.co.uk","created_at":"2026-01-14T19:18:11.410164Z","created_by":"Stuart Bradley","updated_at":"2026-01-14T19:35:10.407306Z","closed_at":"2026-01-14T19:35:10.407306Z","close_reason":"Data models implemented: Player, GameState, Settings structs with NVS persistence. Compilation successful.","dependencies":[{"issue_id":"m5-paper-s3-mtg-life-counter-4pz","depends_on_id":"m5-paper-s3-mtg-life-counter-v7m","type":"blocks","created_at":"2026-01-14T19:20:34.795092Z","created_by":"Stuart Bradley"}]}
{"id":"m5-paper-s3-mtg-life-counter-70s","title":"PlayerCard component: sprite-buffered life display with buttons","description":"**Plan**: /Users/stuart/.claude/plans/parallel-fluttering-stream.md (Epic 4)\n\n**Goal**: Create PlayerCard component with sprite-buffered life display for fast updates.\n\n**What to implement**:\n\n**PlayerCard** (`src/ui/PlayerCard.hpp/cpp`):\n- Extends Component\n- Constructor: `PlayerCard(Player* player, std::function\u003cvoid()\u003e onNameTap)`\n- Uses LGFX_Sprite for double-buffered partial updates\n\n**Visual layout** (fits in ~320x200 or flexible based on player count):\n```\n┌──────────────────────┐\n│  [Player Name]       │  \u003c- tap to edit\n│                      │\n│      [ 20 ]          │  \u003c- LARGE life total\n│                      │\n│  [-5] [-1] [+1] [+5] │  \u003c- life adjustment buttons\n└──────────────────────┘\n```\n\n**Memory**: \n- Sprite buffer: ~320x200x1 byte = 64KB per card\n- Max 6 cards = 384KB (fits in 8MB PSRAM)\n\n**Behavior**:\n- `setPlayer(Player* p)` - update player reference\n- `draw()` - renders to sprite, pushes to display with epd_fastest\n- Life buttons call `player-\u003eadjustLife(delta)` + Sound::lifeUp/Down\n- Name tap triggers callback (parent shows keyboard)\n- Mark dirty only when life changes\n\n**Files to create**:\n- `src/ui/PlayerCard.hpp` (~40 lines)\n- `src/ui/PlayerCard.cpp` (~150 lines)\n\n**Dependencies**: \n- Component base class\n- Player model\n- Sound utilities\n\n**Acceptance criteria**:\n- [ ] Life total displays prominently\n- [ ] Player name displays\n- [ ] +1, -1, +5, -5 buttons work\n- [ ] Life changes trigger appropriate sound\n- [ ] Tapping name area triggers callback\n- [ ] Partial refresh is noticeably fast (not full screen flash)","status":"closed","priority":1,"issue_type":"task","owner":"stuart.bradley@wagestream.co.uk","created_at":"2026-01-14T19:19:27.426454Z","created_by":"Stuart Bradley","updated_at":"2026-01-14T19:44:07.744517Z","closed_at":"2026-01-14T19:44:07.744517Z","close_reason":"Components implemented and compilation successful.","dependencies":[{"issue_id":"m5-paper-s3-mtg-life-counter-70s","depends_on_id":"m5-paper-s3-mtg-life-counter-sho","type":"blocks","created_at":"2026-01-14T19:20:48.616151Z","created_by":"Stuart Bradley"},{"issue_id":"m5-paper-s3-mtg-life-counter-70s","depends_on_id":"m5-paper-s3-mtg-life-counter-o2w","type":"blocks","created_at":"2026-01-14T19:20:48.750677Z","created_by":"Stuart Bradley"},{"issue_id":"m5-paper-s3-mtg-life-counter-70s","depends_on_id":"m5-paper-s3-mtg-life-counter-4pz","type":"blocks","created_at":"2026-01-14T19:20:48.866816Z","created_by":"Stuart Bradley"}]}
{"id":"m5-paper-s3-mtg-life-counter-79t","title":"Power management: inactivity timer, IMU wake, auto-sleep","description":"**Plan**: /Users/stuart/.claude/plans/parallel-fluttering-stream.md (Epic 6)\n\n**Goal**: Implement power management with auto-sleep and motion wake.\n\n**What to implement**:\n\n**Power utilities** (`src/utils/Power.hpp/cpp`):\n- `void init()` - initialize IMU for motion detection\n- `void resetInactivityTimer()` - called on any touch/interaction\n- `void checkInactivity(uint16_t timeoutSecs)` - check if should sleep\n- `void powerOff()` - configure IMU wake interrupt, call M5.Power.powerOff()\n\n**Main loop integration** (updates to `src/main.cpp`):\n- Call `Power::resetInactivityTimer()` on any touch event\n- Call `Power::checkInactivity(settings.sleepTimeoutSecs)` in loop\n- When timeout reached and timeoutSecs \u003e 0: save state, power off\n\n**IMU wake configuration**:\n- Configure BMI270 for any-motion interrupt\n- Set threshold low enough that picking up device triggers wake\n- IMU interrupt goes to PMS150 power chip -\u003e device powers on\n- This achieves ~9.6uA power draw vs 5.1mA for ESP32 deep sleep\n\n**Error handling**:\n- IMU init fails: disable auto-sleep, log warning (device stays on)\n- Save failure before sleep: retry once, then sleep anyway (don't hang)\n\n**Files to create**:\n- `src/utils/Power.hpp` (~20 lines)\n- `src/utils/Power.cpp` (~80 lines)\n\n**Files to update**:\n- `src/main.cpp` - add inactivity tracking in loop\n\n**Dependencies**:\n- Settings model (for sleepTimeoutSecs)\n- GameState model (for save before sleep)\n- Hardware validation (Epic 0 proved IMU wake works)\n\n**Acceptance criteria**:\n- [ ] Device powers off after configured inactivity period\n- [ ] Picking up device powers it back on\n- [ ] timeout=0 disables auto-sleep\n- [ ] Game state saved before power-off\n- [ ] Any touch resets inactivity timer","status":"closed","priority":2,"issue_type":"task","owner":"stuart.bradley@wagestream.co.uk","created_at":"2026-01-14T19:20:14.355875Z","created_by":"Stuart Bradley","updated_at":"2026-01-15T18:25:30.700972Z","closed_at":"2026-01-15T18:25:30.700972Z","close_reason":"Implemented Power utility with inactivity timer and auto-sleep. Device powers off after configured timeout, saves state before shutdown. IMU wake not implemented (see v21 bug).","dependencies":[{"issue_id":"m5-paper-s3-mtg-life-counter-79t","depends_on_id":"m5-paper-s3-mtg-life-counter-4pz","type":"blocks","created_at":"2026-01-14T19:21:07.701355Z","created_by":"Stuart Bradley"},{"issue_id":"m5-paper-s3-mtg-life-counter-79t","depends_on_id":"m5-paper-s3-mtg-life-counter-v7m","type":"blocks","created_at":"2026-01-14T19:21:07.839293Z","created_by":"Stuart Bradley"}]}
{"id":"m5-paper-s3-mtg-life-counter-7gb","title":"Restore previous screen on power-on","description":"**Goal**: When device powers on after shutdown, restore to the screen that was active before power-off.\n\n**User scenario**:\n1. User is on MTG life counter screen\n2. Device auto-sleeps or user powers off\n3. User powers back on\n4. Device should show MTG life counter, not home screen\n\n**Implementation approach**:\n- Save current screen ID to NVS before power-off\n- On boot, read saved screen ID and navigate there\n- If saved screen no longer valid, fall back to home\n\n**Files to update**:\n- `src/utils/Power.cpp` - save screen ID before powerOff()\n- `src/main.cpp` - restore screen on setup()\n- `src/app/ScreenManager.hpp/cpp` - add getCurrentScreenId(), navigateById()\n\n**Dependencies**:\n- m5-paper-s3-mtg-life-counter-79t (Power management)\n\n**Acceptance criteria**:\n- [ ] Screen restored after power cycle\n- [ ] Falls back to home if saved screen invalid\n- [ ] Works with auto-sleep and manual power-off","status":"closed","priority":2,"issue_type":"feature","owner":"stuart.bradley@wagestream.co.uk","created_at":"2026-01-15T18:13:15.593006Z","created_by":"Stuart Bradley","updated_at":"2026-01-15T18:29:39.169892Z","closed_at":"2026-01-15T18:29:39.169892Z","close_reason":"Implemented screen restore on power-on","dependencies":[{"issue_id":"m5-paper-s3-mtg-life-counter-7gb","depends_on_id":"m5-paper-s3-mtg-life-counter-79t","type":"blocks","created_at":"2026-01-15T18:13:36.066981Z","created_by":"Stuart Bradley"}]}
{"id":"m5-paper-s3-mtg-life-counter-hip","title":"Create App abstraction and reorganize files into apps/","description":"Create App/AppRegistry infrastructure and wrap screens into App classes.\n\n**Plan reference**: /Users/stuart/.claude/plans/velvety-tinkering-brooks.md (lines 465-487)\n**Depends on**: m5-paper-s3-mtg-life-counter-tg7 (Layout + Base Screens)\n\n## Implementation\n\n1. Create src/app/App.hpp (plan lines 52-77):\n   - AppMetadata struct: id, name, icon, showInLauncher\n   - App base class: metadata(), onLaunch(), onSuspend(), getMainScreen(), getScreen()\n\n2. Create src/app/AppRegistry.hpp/cpp (plan lines 155-176):\n   - Singleton, registerApp(), launchableAppCount(), getLaunchableApp(), findApp()\n\n3. Create directory structure:\n   - src/apps/home/ (HomeApp, HomeScreen)\n   - src/apps/mtg/ (MTGApp, MTGLifeScreen, MTGSettingsScreen, PlayerCard)\n   - src/apps/settings/ (SettingsApp, SystemSettingsScreen, WiFiScreen)\n\n4. Create app wrapper classes:\n   - HomeApp: owns HomeScreen, showInLauncher=false\n   - MTGApp: owns GameState + screens (plan lines 83-124)\n   - SettingsApp: owns Settings + screens\n\n5. Update screens to take App* instead of ScreenManager*\n\n6. Update HomeScreen to use AppRegistry for dynamic grid\n\n**Note**: Keep ScreenManager working - Navigation is next issue.\n\n## Acceptance Criteria\n- [ ] Files moved to src/apps/ structure\n- [ ] AppRegistry returns correct launchable apps\n- [ ] HomeScreen uses dynamic grid from registry\n- [ ] Apps own their state (GameState, Settings)\n- [ ] Full navigation still works","status":"open","priority":0,"issue_type":"task","owner":"stuart.bradley@wagestream.co.uk","created_at":"2026-01-15T19:38:11.438527Z","created_by":"Stuart Bradley","updated_at":"2026-01-15T19:38:11.438527Z","dependencies":[{"issue_id":"m5-paper-s3-mtg-life-counter-hip","depends_on_id":"m5-paper-s3-mtg-life-counter-tg7","type":"blocks","created_at":"2026-01-15T19:38:11.44014Z","created_by":"Stuart Bradley"}]}
{"id":"m5-paper-s3-mtg-life-counter-ncc","title":"Replace ScreenManager with Navigation class","description":"Replace ScreenManager with Navigation that manages app launching and screen stacks.\n\n**Plan reference**: /Users/stuart/.claude/plans/velvety-tinkering-brooks.md (lines 491-509)\n**Depends on**: m5-paper-s3-mtg-life-counter-hip (App Abstraction)\n\n## Implementation\n\n1. Create src/app/Navigation.hpp/cpp (plan lines 198-237):\n   - Singleton: launchApp(), exitApp(), goHome(), pushScreen(), popScreen()\n   - Screen stack (MAX_DEPTH=4), current app pointer\n   - Stack semantics per plan table (lines 232-237)\n\n2. Update main.cpp:\n   - Remove ScreenManager, screen pointer globals\n   - Explicit app registration, use Navigation in main loop\n\n3. Update all screens:\n   - Remove _manager member\n   - Use Navigation::instance() for all navigation\n\n4. Update power cycle restore:\n   - Save app ID + screen ID\n   - Restore via Navigation on boot\n\n5. Delete src/app/ScreenManager.hpp/cpp\n\n6. Remove ScreenId enum from src/ui/Screen.hpp\n\n## Acceptance Criteria\n- [ ] ScreenManager deleted, ScreenId removed\n- [ ] All navigation uses Navigation singleton\n- [ ] Full test checklist passes (plan lines 659-679)\n- [ ] Power cycle restore works\n- [ ] WiFi connection works","status":"open","priority":0,"issue_type":"task","owner":"stuart.bradley@wagestream.co.uk","created_at":"2026-01-15T19:38:21.798399Z","created_by":"Stuart Bradley","updated_at":"2026-01-15T19:38:21.798399Z","dependencies":[{"issue_id":"m5-paper-s3-mtg-life-counter-ncc","depends_on_id":"m5-paper-s3-mtg-life-counter-hip","type":"blocks","created_at":"2026-01-15T19:38:21.799815Z","created_by":"Stuart Bradley"}]}
{"id":"m5-paper-s3-mtg-life-counter-o2w","title":"Sound utilities: buzzer tones for UI feedback","description":"**Plan**: /Users/stuart/.claude/plans/parallel-fluttering-stream.md (Epic 2)\n\n**Goal**: Create sound utilities for tonal feedback.\n\n**What to implement**:\n\n**Sound** (`src/utils/Sound.hpp/cpp`):\n- `namespace Sound` or static class\n- `void init()` - initialize speaker\n- `void click()` - short click sound for button press\n- `void lifeUp()` - ascending tone for +life\n- `void lifeDown()` - descending tone for -life  \n- `void alert()` - attention-getting tone\n- `void setEnabled(bool enabled)` - respects settings\n- Internal: uses M5.Speaker.tone() with different frequencies/durations\n\n**Tone suggestions**:\n- Click: 1000Hz, 20ms\n- LifeUp: 800Hz-\u003e1200Hz sweep, 50ms\n- LifeDown: 1200Hz-\u003e800Hz sweep, 50ms\n- Alert: 500Hz, 200ms\n\n**Files to create**:\n- `src/utils/Sound.hpp` (~20 lines)\n- `src/utils/Sound.cpp` (~50 lines)\n\n**Dependencies**: None (hardware validated in Epic 0)\n\n**Acceptance criteria**:\n- [ ] All four tones play distinct sounds\n- [ ] setEnabled(false) silences all tones\n- [ ] Tones don't block (non-blocking playback)","status":"closed","priority":1,"issue_type":"task","owner":"stuart.bradley@wagestream.co.uk","created_at":"2026-01-14T19:18:40.403677Z","created_by":"Stuart Bradley","updated_at":"2026-01-14T19:39:28.87188Z","closed_at":"2026-01-14T19:39:28.87188Z","close_reason":"Sound utilities implemented: click(), lifeUp(), lifeDown(), alert() with enable/disable toggle. Compilation successful.","dependencies":[{"issue_id":"m5-paper-s3-mtg-life-counter-o2w","depends_on_id":"m5-paper-s3-mtg-life-counter-v7m","type":"blocks","created_at":"2026-01-14T19:20:35.019376Z","created_by":"Stuart Bradley"}]}
{"id":"m5-paper-s3-mtg-life-counter-phs","title":"Add WiFi signal indicator to toolbar","description":"**Problem**: Toolbar shows battery strength but no WiFi connection status. User can't tell if WiFi is connected or signal strength at a glance.\n\n**Solution**: Add WiFi signal bars to toolbar next to battery indicator. Should show:\n- Disconnected: crossed out or empty icon\n- Connected: signal bars based on RSSI (similar to WiFiScreen::getSignalBars())\n\n**Files**:\n- `src/ui/Toolbar.cpp` - Add WiFi status drawing\n- `src/ui/Toolbar.hpp` - May need state tracking","status":"closed","priority":2,"issue_type":"feature","owner":"stuart.bradley@wagestream.co.uk","created_at":"2026-01-15T18:56:56.714318Z","created_by":"Stuart Bradley","updated_at":"2026-01-15T18:59:09.141826Z","closed_at":"2026-01-15T18:59:09.141826Z","close_reason":"Added WiFi signal indicator to toolbar - shows (x) when disconnected, (+) to (((+))) based on signal strength"}
{"id":"m5-paper-s3-mtg-life-counter-qj1","title":"Keyboard component: on-screen QWERTY for name editing","description":"**Plan**: /Users/stuart/.claude/plans/parallel-fluttering-stream.md (Epic 2)\n\n**Goal**: Create on-screen QWERTY keyboard for editing player names.\n\n**What to implement**:\n\n**Keyboard** (`src/ui/Keyboard.hpp/cpp`):\n- Extends Component  \n- Callback-based: `using Callback = std::function\u003cvoid(const char* result, bool confirmed)\u003e`\n- Constructor: `Keyboard(const char* initialText, Callback onComplete)`\n\n**Layout** (960x200px, bottom of screen):\n```\nQ  W  E  R  T  Y  U  I  O  P  \u003c-\nA  S  D  F  G  H  J  K  L  '\n^  Z  X  C  V  B  N  M  .  ^\n[123]  [____SPACE____]  [DONE]  [CANCEL]\n```\n\n**Key sizes**:\n- Letter keys: 70x45px (large touch targets)\n- Space bar: 400x45px\n- Action buttons (DONE/CANCEL): 100x45px\n- Backspace (\u003c-): 70x45px\n\n**State**:\n- `char _buffer[16]` - max 15 chars + null\n- `uint8_t _cursorPos`\n- `bool _shifted` - for uppercase\n- Shift toggles on each letter (auto-unshift after typing)\n\n**Behavior**:\n- Show text preview above keyboard\n- DONE calls callback with (buffer, true)\n- CANCEL calls callback with (original, false)\n- [123] toggles number row (bonus, can defer if complex)\n\n**Files to create**:\n- `src/ui/Keyboard.hpp` (~40 lines)\n- `src/ui/Keyboard.cpp` (~150 lines)\n\n**Dependencies**: Requires Component base class\n\n**Acceptance criteria**:\n- [ ] All letter keys work\n- [ ] Shift toggles uppercase\n- [ ] Backspace deletes\n- [ ] Space adds space\n- [ ] DONE returns edited text with confirmed=true\n- [ ] CANCEL returns original text with confirmed=false\n- [ ] Text preview shows current buffer","status":"closed","priority":1,"issue_type":"task","owner":"stuart.bradley@wagestream.co.uk","created_at":"2026-01-14T19:19:02.281436Z","created_by":"Stuart Bradley","updated_at":"2026-01-14T19:44:07.768753Z","closed_at":"2026-01-14T19:44:07.768753Z","close_reason":"Components implemented and compilation successful.","dependencies":[{"issue_id":"m5-paper-s3-mtg-life-counter-qj1","depends_on_id":"m5-paper-s3-mtg-life-counter-sho","type":"blocks","created_at":"2026-01-14T19:20:39.921819Z","created_by":"Stuart Bradley"}]}
{"id":"m5-paper-s3-mtg-life-counter-sho","title":"UI framework: Component, Screen base classes, ScreenManager","description":"**Plan**: /Users/stuart/.claude/plans/parallel-fluttering-stream.md (Epic 1)\n\n**Goal**: Create the core UI framework that all screens and components will use.\n\n**What to implement**:\n\n1. **Component base class** (`src/ui/Component.hpp`):\n   - `struct Rect { int16_t x, y, w, h; }` - bounds rectangle\n   - `bool _dirty` flag for redraw tracking\n   - `virtual void draw(M5GFX* gfx)` \n   - `virtual bool handleTouch(const m5::touch_detail_t\u0026 touch)`\n   - `bool contains(int16_t x, int16_t y)` - hit testing\n\n2. **Screen base class** (`src/ui/Screen.hpp`):\n   - `virtual void onEnter()`, `virtual void onExit()`\n   - `virtual void update()`, `virtual void draw(M5GFX* gfx)`\n   - `virtual bool handleTouch(const m5::touch_detail_t\u0026 touch)`\n\n3. **ScreenManager** (`src/app/ScreenManager.hpp/cpp`):\n   - Holds current and previous screen pointers (no stack needed)\n   - `setScreen(Screen* newScreen)` - calls onExit/onEnter\n   - `goBack()` - returns to previous screen\n   - `getCurrentScreen()`, `update()`, `draw()`\n\n**Design decisions**:\n- Pass M5GFX* (or LovyanGFX*) for drawing\n- 150ms touch debounce at component level\n- Dirty flag pattern for efficient redraws\n\n**Files to create**:\n- `src/ui/Component.hpp` (~50 lines)\n- `src/ui/Screen.hpp` (~35 lines)\n- `src/app/ScreenManager.hpp` (~25 lines)\n- `src/app/ScreenManager.cpp` (~50 lines)\n\n**Acceptance criteria**:\n- [ ] All classes compile\n- [ ] Component::contains() correctly reports hits inside/outside bounds\n- [ ] ScreenManager::setScreen() calls onExit on old, onEnter on new\n- [ ] ScreenManager::goBack() works (current becomes old, old becomes current)","status":"closed","priority":0,"issue_type":"task","owner":"stuart.bradley@wagestream.co.uk","created_at":"2026-01-14T19:18:22.753957Z","created_by":"Stuart Bradley","updated_at":"2026-01-14T19:36:47.593042Z","closed_at":"2026-01-14T19:36:47.593042Z","close_reason":"UI framework implemented: Component base class with Rect/dirty flag, Screen base class with lifecycle methods, ScreenManager with setScreen/goBack. Compilation successful.","dependencies":[{"issue_id":"m5-paper-s3-mtg-life-counter-sho","depends_on_id":"m5-paper-s3-mtg-life-counter-v7m","type":"blocks","created_at":"2026-01-14T19:20:34.910029Z","created_by":"Stuart Bradley"}]}
{"id":"m5-paper-s3-mtg-life-counter-swj","title":"Add WiFi disconnect button","description":"**Problem**: Once connected to WiFi, there's no way to disconnect or forget the network.\n\n**Solution**: Add disconnect functionality to WiFiScreen:\n- When tapping a connected network, show option to disconnect\n- Could be a button on the connected network row, or a confirmation dialog\n- Should call WiFi.disconnect() and clear saved credentials from Preferences\n\n**Files**:\n- `src/ui/screens/WiFiScreen.cpp` - Add disconnect handling\n- `src/ui/screens/WiFiScreen.hpp` - May need state for disconnect UI","status":"closed","priority":2,"issue_type":"feature","owner":"stuart.bradley@wagestream.co.uk","created_at":"2026-01-15T18:56:56.86849Z","created_by":"Stuart Bradley","updated_at":"2026-01-15T19:00:10.426219Z","closed_at":"2026-01-15T19:00:10.426219Z","close_reason":"Added DISCONNECT button to WiFi screen header bar - appears when connected, clears saved credentials on disconnect"}
{"id":"m5-paper-s3-mtg-life-counter-tdp","title":"Toolbar component: battery, time, WiFi stub","description":"**Plan**: /Users/stuart/.claude/plans/parallel-fluttering-stream.md (Epic 2)\n\n**Goal**: Create system toolbar that appears on all screens.\n\n**What to implement**:\n\n**Toolbar** (`src/ui/Toolbar.hpp/cpp`):\n- Extends Component\n- Fixed height ~40px at top of screen\n- Displays:\n  - Battery percentage + icon (from M5.Power.getBatteryLevel())\n  - Current time from RTC (from M5.Rtc.getDateTime())\n  - WiFi indicator (stub - just show \"---\" or empty, WiFi deferred to future)\n- Auto-updates on draw() (reads fresh values)\n\n**Layout** (960px wide):\n```\n[WiFi stub: 60px] [Time: HH:MM centered] [Battery: XX% + icon: 80px]\n```\n\n**Files to create**:\n- `src/ui/Toolbar.hpp` (~25 lines)\n- `src/ui/Toolbar.cpp` (~60 lines)\n\n**Dependencies**: Requires Component base class\n\n**Acceptance criteria**:\n- [ ] Shows battery percentage (updates on each draw)\n- [ ] Shows time from RTC (format HH:MM)\n- [ ] WiFi area shows placeholder (no crash)\n- [ ] Toolbar renders cleanly at top of display","status":"closed","priority":1,"issue_type":"task","owner":"stuart.bradley@wagestream.co.uk","created_at":"2026-01-14T19:18:49.65094Z","created_by":"Stuart Bradley","updated_at":"2026-01-14T19:44:07.719846Z","closed_at":"2026-01-14T19:44:07.719846Z","close_reason":"Components implemented and compilation successful.","dependencies":[{"issue_id":"m5-paper-s3-mtg-life-counter-tdp","depends_on_id":"m5-paper-s3-mtg-life-counter-sho","type":"blocks","created_at":"2026-01-14T19:20:39.803979Z","created_by":"Stuart Bradley"}]}
{"id":"m5-paper-s3-mtg-life-counter-tg7","title":"Add Device/Layout abstraction and base screen classes","description":"Remove hardcoded screen dimensions and reduce UI boilerplate.\n\n**Plan reference**: /Users/stuart/.claude/plans/velvety-tinkering-brooks.md (lines 436-461)\n\n## Part A - Layout Abstraction\n\n1. Create `src/platform/Device.hpp`:\n   - SCREEN_WIDTH=960, SCREEN_HEIGHT=540\n   - TOOLBAR_HEIGHT=32, HEADER_HEIGHT=44, MIN_TOUCH_TARGET=44\n\n2. Create `src/ui/Layout.hpp` with helpers (plan lines 276-301)\n\n3. Replace hardcoded dimensions in:\n   - src/ui/Toolbar.cpp:5 (constructor)\n   - src/ui/HeaderBar.cpp:7-9 (button positioning)\n   - src/ui/Keyboard.cpp:27 (bounds)\n   - src/ui/screens/HomeScreen.cpp:14-15,21-22\n   - src/ui/screens/MTGLifeScreen.cpp:84-85\n   - src/ui/screens/WiFiScreen.cpp:129,151,273,303,356\n\n## Part B - Base Screen Classes\n\n1. Create src/ui/ToolbarScreen.hpp/cpp (plan lines 306-340)\n2. Create src/ui/HeaderScreen.hpp/cpp (plan lines 343-371)\n3. Migrate screens:\n   - HomeScreen -\u003e ToolbarScreen\n   - MTGLifeScreen, MTGSettingsScreen, SystemSettingsScreen, WiFiScreen -\u003e HeaderScreen\n\n## Acceptance Criteria\n- [ ] No 960/540 literals except in Device.hpp\n- [ ] All screens inherit from base classes\n- [ ] Device test: all screens render, touch works, keyboard works","status":"closed","priority":0,"issue_type":"task","owner":"stuart.bradley@wagestream.co.uk","created_at":"2026-01-15T19:37:57.971552Z","created_by":"Stuart Bradley","updated_at":"2026-01-21T10:49:58.280934Z","closed_at":"2026-01-21T10:49:58.280934Z","close_reason":"Implemented Device/Layout abstraction and base screen classes. Created Device.hpp with screen constants, Layout.hpp with layout helpers, ToolbarScreen and HeaderScreen base classes. Migrated all 5 screens to use base classes. Build succeeds. Awaiting device testing."}
{"id":"m5-paper-s3-mtg-life-counter-ums","title":"Home Screen: Settings app always displays last","description":"**Goal**: Settings app icon should always appear last (rightmost/bottommost position) on the Home Screen regardless of app registration order.\n\n**Current behavior**: Apps display in registration order in HomeScreen.\n\n**Desired behavior**: Settings app is always the last icon in the grid layout.\n\n**Implementation approach**:\n- Sort apps before rendering with Settings at end\n- Or: hardcode Settings position when laying out grid\n\n**Files to update**:\n- `src/ui/screens/HomeScreen.cpp` - sort/position logic\n\n**Acceptance criteria**:\n- [ ] Settings app always appears last on home screen\n- [ ] Works regardless of how many apps are registered\n- [ ] Other apps maintain their relative order","status":"closed","priority":2,"issue_type":"task","owner":"stuart.bradley@wagestream.co.uk","created_at":"2026-01-15T18:13:15.462533Z","created_by":"Stuart Bradley","updated_at":"2026-01-15T18:14:17.155145Z","closed_at":"2026-01-15T18:14:17.155145Z","close_reason":"Swapped positions in HomeScreen.cpp so Settings is rightmost"}
{"id":"m5-paper-s3-mtg-life-counter-v21","title":"Investigate IMU wake-from-poweroff not triggering","description":"**Context**: During hardware validation (m5-paper-s3-mtg-life-counter-v7m), IMU wake from power-off did not work.\n\n**What happened**:\n- IMU (BMI270) initializes and reads correctly: X=0.01, Y=0.01, Z=-1.00\n- Device powers off via M5.Power.powerOff()\n- Moving/picking up device does NOT trigger wake\n\n**Investigation needed**:\n1. Check if M5Paper S3 hardware supports IMU-\u003ePMS150 wake path\n2. Review M5Unified examples for motion wake configuration\n3. May need explicit BMI270 interrupt configuration before powerOff()\n4. Check if different power-off method needed (deep sleep vs full poweroff)\n\n**Impact**: P3 - Nice-to-have feature, not blocking MVP. Fallback is button-press wake only.\n\n**References**:\n- Hardware validation test code: src/main.cpp (temporary, will be replaced)\n- Related issue: m5-paper-s3-mtg-life-counter-79t (power management)","status":"closed","priority":3,"issue_type":"bug","owner":"stuart.bradley@wagestream.co.uk","created_at":"2026-01-14T19:33:01.841003Z","created_by":"Stuart Bradley","updated_at":"2026-01-15T18:40:52.887914Z","closed_at":"2026-01-15T18:40:52.887914Z","close_reason":"Hardware limitation: M5Paper S3 does not support IMU-triggered wake from power-off. Button press wake is the only supported method."}
{"id":"m5-paper-s3-mtg-life-counter-v7m","title":"Hardware validation: test IMU wake, NVS, buzzer, e-ink refresh","description":"**Plan**: /Users/stuart/.claude/plans/parallel-fluttering-stream.md (Epic 0)\n\n**Goal**: Validate all hardware features work before building app layer.\n\n**What to implement**:\n1. Test IMU motion wake: configure BMI270, power off, verify wake on movement\n2. Test NVS read/write cycle with Preferences library\n3. Test buzzer tones via M5.Speaker\n4. Test e-ink partial refresh speed with epd_fastest mode\n\n**Where**: `src/main.cpp` (temporary test code, will be replaced)\n\n**Files to read**: M5Unified library examples for IMU, Speaker, Display APIs\n**Files to write**: `src/main.cpp` (~100 lines of test code)\n\n**Acceptance criteria**:\n- [ ] IMU wake from power-off works (manual test: pick up device)\n- [ ] NVS write then read returns correct value\n- [ ] Buzzer plays different frequency tones\n- [ ] Partial refresh visibly faster than full refresh\n- [ ] All tests logged to serial monitor\n\n**Exit criteria**: All hardware features work in isolation. Document any gotchas for later.","status":"closed","priority":0,"issue_type":"task","owner":"stuart.bradley@wagestream.co.uk","created_at":"2026-01-14T19:17:52.495803Z","created_by":"Stuart Bradley","updated_at":"2026-01-14T19:32:41.813566Z","closed_at":"2026-01-14T19:32:41.813566Z","close_reason":"Hardware validation complete. NVS: PASS, Buzzer: PASS (4 tones confirmed), E-ink: PASS (display() is async - returns immediately), Touch: PASS, IMU: reads correctly but wake-from-poweroff not working. Core hardware ready for app development."}
{"id":"m5-paper-s3-mtg-life-counter-vmh","title":"Add icon generation script and developer documentation","description":"Create Python icon converter and DEVELOPMENT.md guide.\n\n**Plan reference**: /Users/stuart/.claude/plans/velvety-tinkering-brooks.md (lines 549-654)\n**Depends on**: m5-paper-s3-mtg-life-counter-hip (App Abstraction - needs App structure for docs)\n\n## Part A - Icon Tooling (lines 549-635)\n\n1. Create tools/icons/convert_icons.py:\n   - PIL to convert PNG/BMP to 1-bit packed C++ arrays\n   - Resize to 64x64, output to icons_generated.hpp\n\n2. Update platformio.ini with build hook\n\n3. Update icons.hpp to include generated header\n\n4. Test with sample icon\n\n## Part B - Documentation (lines 640-654)\n\nCreate docs/DEVELOPMENT.md covering:\n- Architecture overview\n- Creating new apps (step-by-step)\n- Screen lifecycle\n- State ownership\n- Navigation\n- Layout system\n- Adding icons\n- Testing\n- Build commands\n\n## Acceptance Criteria\n- [ ] convert_icons.py generates valid header\n- [ ] Test icon renders on device\n- [ ] DEVELOPMENT.md is complete\n- [ ] New developer could create app from guide","status":"open","priority":3,"issue_type":"task","owner":"stuart.bradley@wagestream.co.uk","created_at":"2026-01-15T19:38:40.896839Z","created_by":"Stuart Bradley","updated_at":"2026-01-15T19:38:40.896839Z","dependencies":[{"issue_id":"m5-paper-s3-mtg-life-counter-vmh","depends_on_id":"m5-paper-s3-mtg-life-counter-hip","type":"blocks","created_at":"2026-01-15T19:38:40.898693Z","created_by":"Stuart Bradley"}]}
{"id":"m5-paper-s3-mtg-life-counter-xgr","title":"Home screen: app launcher with Settings and MTG icons","description":"**Plan**: /Users/stuart/.claude/plans/parallel-fluttering-stream.md (Epic 3)\n\n**Goal**: Create home screen launcher that displays app icons and launches apps.\n\n**What to implement**:\n\n1. **HomeScreen** (`src/ui/screens/HomeScreen.hpp/cpp`):\n   - Extends Screen\n   - Shows Toolbar at top\n   - 2-icon grid: Settings (gear), MTG Life Counter\n   - Touch on icon launches corresponding screen\n   - Uses ScreenManager to switch screens\n\n2. **Icons** (`src/assets/icons.hpp`):\n   - `const uint8_t ICON_SETTINGS[]` - 6-spoke gear, 64x64 or 80x80\n   - `const uint8_t ICON_MTG[]` - simplified MTG logo or card icon, 64x64 or 80x80\n   - Format: 1-bit or grayscale bitmap as const array\n\n**Layout** (960x540):\n```\n[Toolbar: 40px]\n[                                    ]\n[    [Settings]     [MTG]            ]\n[     Settings    Life Counter       ]\n[                                    ]\n```\n\n- Icons centered in cards with label below\n- Cards ~200x180px each, centered horizontally\n- Generous spacing for touch targets\n\n**Files to create**:\n- `src/ui/screens/HomeScreen.hpp` (~30 lines)\n- `src/ui/screens/HomeScreen.cpp` (~80 lines)\n- `src/assets/icons.hpp` (~100 lines for icon data)\n\n**Update**:\n- `src/main.cpp` - set HomeScreen as initial screen\n\n**Dependencies**: \n- Component, Screen, ScreenManager (UI framework)\n- Toolbar component\n\n**Acceptance criteria**:\n- [ ] Home screen displays on boot\n- [ ] Toolbar shows at top with battery/time\n- [ ] Two app icons visible with labels\n- [ ] Tap Settings icon -\u003e navigates to SettingsScreen (stub OK for now)\n- [ ] Tap MTG icon -\u003e navigates to MTGLifeScreen (stub OK for now)","status":"closed","priority":1,"issue_type":"feature","owner":"stuart.bradley@wagestream.co.uk","created_at":"2026-01-14T19:19:14.741455Z","created_by":"Stuart Bradley","updated_at":"2026-01-15T18:11:17.992574Z","closed_at":"2026-01-15T18:11:17.992574Z","close_reason":"Implemented home screen with app launcher, icons, navigation to MTG Life and System Settings. Created reusable HeaderBar component. Fixed navigation bugs.","dependencies":[{"issue_id":"m5-paper-s3-mtg-life-counter-xgr","depends_on_id":"m5-paper-s3-mtg-life-counter-sho","type":"blocks","created_at":"2026-01-14T19:20:44.013871Z","created_by":"Stuart Bradley"},{"issue_id":"m5-paper-s3-mtg-life-counter-xgr","depends_on_id":"m5-paper-s3-mtg-life-counter-tdp","type":"blocks","created_at":"2026-01-14T19:20:44.167528Z","created_by":"Stuart Bradley"}]}
{"id":"m5-paper-s3-mtg-life-counter-ye3","title":"Build WiFi settings screen","description":"**Context**: The UI mockup includes a WiFi selection screen accessible from System Settings, but this is not yet implemented.\n\n**Requirements**:\n- Add WiFi row to SystemSettingsScreen that navigates to WiFi screen\n- Create new WiFiScreen that:\n  - Scans for available networks\n  - Shows network list with signal strength bars (e.g., `▂▄▆█`)\n  - Shows lock icon for secured networks\n  - Highlights currently connected network\n  - Allows selecting a network to connect\n- Implement password entry using existing Keyboard component\n- Save/restore WiFi credentials using Preferences\n\n**References**:\n- UI mockup: `ui-mockup/index.html:1040-1093` (WiFi selection view)\n- SystemSettingsScreen: `src/ui/screens/SystemSettingsScreen.cpp`\n- Keyboard component: `src/ui/Keyboard.cpp`\n- M5Unified WiFi: Use standard ESP32 WiFi APIs","status":"closed","priority":2,"issue_type":"feature","owner":"stuart.bradley@wagestream.co.uk","created_at":"2026-01-15T18:39:50.692587Z","created_by":"Stuart Bradley","updated_at":"2026-01-15T18:45:51.023985Z","closed_at":"2026-01-15T18:45:51.023985Z","close_reason":"Implemented WiFiScreen with network scanning, signal strength display, password entry via keyboard, and credential persistence"}
{"id":"m5-paper-s3-mtg-life-counter-yg7","title":"Add connecting splash/indicator during WiFi connection","description":"**Problem**: When connecting to WiFi after entering password and pressing DONE, the UI hangs for up to 10 seconds with no feedback. User doesn't know if it's working.\n\n**Solution**: Show a \"Connecting...\" overlay or splash screen while WiFi.begin() and the connection timeout loop runs in WiFiScreen::connectToNetwork().\n\n**Files**:\n- `src/ui/screens/WiFiScreen.cpp` - Add visual feedback during connection\n- Could reuse the scanning message area or add a modal overlay","status":"closed","priority":2,"issue_type":"feature","owner":"stuart.bradley@wagestream.co.uk","created_at":"2026-01-15T18:56:56.571706Z","created_by":"Stuart Bradley","updated_at":"2026-01-15T19:01:16.233034Z","closed_at":"2026-01-15T19:01:16.233034Z","close_reason":"Added modal splash overlay showing 'CONNECTING...' with network name during WiFi connection"}
{"id":"m5-paper-s3-mtg-life-counter-zis","title":"System Settings Screen: sound toggle, sleep timeout","description":"**Plan**: /Users/stuart/.claude/plans/parallel-fluttering-stream.md (Epic 5)\n\n**Goal**: Create system-wide settings app.\n\n**What to implement**:\n\n**SettingsScreen** (`src/ui/screens/SettingsScreen.hpp/cpp`):\n- Extends Screen\n- Back button to return to HomeScreen\n\n**Settings rows**:\n1. **Sound**: [ON] [OFF] toggle\n2. **Auto-Sleep**: [Off] [1min] [5min] [10min] selector\n\n**Layout** (960x540):\n```\n[Toolbar]\n[\u003c Back]                Settings\n\nSound:        [ON]  [OFF]\n\nAuto-Sleep:   [Off] [1m] [5m] [10m]\n\n```\n\n**Behavior**:\n- Sound toggle: updates Settings.soundEnabled, calls Sound::setEnabled()\n- Sleep selector: updates Settings.sleepTimeoutSecs (0/60/300/600)\n- Back: save settings to NVS, return to home\n\n**Files to create**:\n- `src/ui/screens/SettingsScreen.hpp` (~30 lines)\n- `src/ui/screens/SettingsScreen.cpp` (~120 lines)\n\n**Dependencies**:\n- Screen, ScreenManager\n- Button component\n- Settings model\n- Toolbar component\n- Sound utilities\n\n**Acceptance criteria**:\n- [ ] Sound toggle changes Sound::setEnabled state\n- [ ] Sound toggle persists after app restart\n- [ ] Sleep timeout selector works\n- [ ] Sleep timeout persists after app restart\n- [ ] Back returns to home screen","status":"closed","priority":2,"issue_type":"feature","owner":"stuart.bradley@wagestream.co.uk","created_at":"2026-01-14T19:20:00.104291Z","created_by":"Stuart Bradley","updated_at":"2026-01-15T18:16:22.11123Z","closed_at":"2026-01-15T18:16:22.11123Z","close_reason":"Implemented sound toggle and auto-sleep selector. Settings persist to NVS.","dependencies":[{"issue_id":"m5-paper-s3-mtg-life-counter-zis","depends_on_id":"m5-paper-s3-mtg-life-counter-xgr","type":"blocks","created_at":"2026-01-14T19:21:02.89667Z","created_by":"Stuart Bradley"},{"issue_id":"m5-paper-s3-mtg-life-counter-zis","depends_on_id":"m5-paper-s3-mtg-life-counter-0g5","type":"blocks","created_at":"2026-01-14T19:21:03.043522Z","created_by":"Stuart Bradley"},{"issue_id":"m5-paper-s3-mtg-life-counter-zis","depends_on_id":"m5-paper-s3-mtg-life-counter-4pz","type":"blocks","created_at":"2026-01-14T19:21:03.170718Z","created_by":"Stuart Bradley"},{"issue_id":"m5-paper-s3-mtg-life-counter-zis","depends_on_id":"m5-paper-s3-mtg-life-counter-o2w","type":"blocks","created_at":"2026-01-14T19:21:03.287442Z","created_by":"Stuart Bradley"}]}
